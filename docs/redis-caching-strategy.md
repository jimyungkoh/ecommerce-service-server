# Redis Caching Strategy for E-commerce Service

## 목차
- [개요](#개요)
  - [읽기 작업 위주 데이터](#읽기-작업-위주-데이터)
  - [읽기/쓰기 혼합 작업 데이터](#읽기쓰기-혼합-작업-데이터)
- [캐싱 전략](#캐싱-전략)
  - [읽기 전략](#읽기-전략)
  - [쓰기 전략](#쓰기-전략)
- [이커머스 서비스에 캐싱 전략 적용하기](#이커머스-서비스에-캐싱-전략-적용하기)
  - [읽기 작업만 빈번하게 일어나는 데이터](#읽기-작업만-빈번하게-일어나는-데이터)
  - [읽기 작업과 쓰기 작업이 동시에 빈번하게 일어나는 데이터](#읽기-작업과-쓰기-작업이-동시에-빈번하게-일어나는-데이터)
- [결론: 이커머스 캐싱 전략 구현 방향](#결론-이커머스-캐싱-전략-구현-방향)

## 개요
이커머스 서비스에서는 상품 조회, 재고 확인, 인기 상품 조회 등 다양한 읽기 작업이 빈번하게 발생합니다. 특히 할인 이벤트나 프로모션 시에는 특정 상품에 대한 동시 조회가 급증하는 특징이 있습니다.

이러한 데이터 접근 패턴을 분석하여 다음과 같이 분류했습니다:
### 읽기 작업 위주 데이터

#### 상품(Product) 정보
- 상품명, 가격, 상품의 기본 정보
- 상품 상세 페이지, 상품 목록 페이지, 검색 결과 페이지 등에서 지속적으로 조회 발생
- 데이터 갱신은 상품 가격 변경, 상품 정보 수정 등 관리자 작업으로 인해 간헐적으로 발생
- 데이터 일관성이 중요하나, 수 분 내의 지연은 허용 가능

#### 인기 상품(Popular Product) 목록
- 일정 기간(3일) 동안의 판매량을 기준으로 집계된 인기 상품 정보
- 메인 페이지, 카테고리 페이지 등에서 프로모션 용도로 활용
- 데이터 갱신은 배치 작업을 통해 정기적(1일)으로 발생
- 실시간성보다는 트렌드 파악이 중요하므로, 데이터 지연 허용 가능

### 읽기/쓰기 혼합 작업 데이터

#### 상품 재고(Product Stock) 정보

- 상품별 현재 구매 가능한 수량 정보
- 상품 상세 페이지 조회, 장바구니 담기, 주문 처리 등 다양한 시점에서 조회 발생
- 주문 완료, 주문 취소, 반품 처리, 재고 입고 등으로 인해 빈번한 갱신 발생
- 재고 수량이 적을 때는 경쟁이 심해 읽기/쓰기 빈도가 더욱 증가
- 주문 프로세스와 직결되어 데이터 정확성이 매우 중요

## 캐싱 전략 
### 읽기 전략
| 전략        | Cache-Aside (Lazy Loading)                                     | Read-Through                                            |
| --------- | -------------------------------------------------------------- | ------------------------------------------------------- |
| **동작 방식** | • 캐시 확인 후 없으면 DB 조회<br>• 앱이 직접 캐시 갱신<br>• 필요할 때만 로딩            | • 캐시 계층이 DB 조회 담당<br>• 캐시가 직접 데이터 갱신<br>• 캐시 미스 시 자동 로딩 |
| **장점**    | • 구현 단순<br>• 불필요한 데이터 없음<br>• 캐시 장애 시 DB 사용 가능                 | • 캐시 로직 통합 관리<br>• 일관된 데이터 로딩<br>• 앱 로직 단순화             |
| **단점**    | • Cache Stampede 위험<br>• 다중 서버 시 동기화 이슈<br>• 초기 접근 시 지연        | • 캐시 계층 구현 복잡<br>• 캐시-DB 결합도 높음<br>• 유연성 제한             |
| **사용 시점** | • HotSpot 데이터 미리 캐싱<br>• Cache Miss가 치명적이지 않을 때<br>• 간단한 조회 로직 | • 일관된 데이터 필요 시<br>• 복잡한 조회 로직<br>• 캐시 정책 중앙화 필요 시       |
### 쓰기 전략
| 전략        | Write-Through                                  | Write-Around                                | Write-Back                                  |
| --------- | ---------------------------------------------- | ------------------------------------------- | ------------------------------------------- |
| **동작 방식** | • 캐시와 DB 동시 갱신<br>• 즉시 동기화<br>• 원자적 업데이트       | • DB만 직접 갱신<br>• 캐시는 무효화<br>• 조회 시점에 캐시 갱신  | • 캐시만 먼저 갱신<br>• 배치로 DB 반영<br>• 비동기 DB 갱신   |
| **장점**    | • 데이터 일관성 높음<br>• 읽기 성능 보장<br>• 구현 명확          | • 쓰기 지연 없음<br>• 캐시 부하 감소<br>• DB 우선 보장      | • 쓰기 성능 좋음<br>• DB 부하 분산<br>• 배치 처리 효율      |
| **단점**    | • 2번의 I/O 발생<br>• 쓰기 지연 발생<br>• 자원 사용량 높음      | • 캐시 미스 증가<br>• 초기 읽기 지연<br>• 캐시 갱신 비용      | • 데이터 유실 위험<br>• 일관성 보장 어려움<br>• 구현 복잡      |
| **사용 시점** | • 데이터 일관성 중요 시<br>• 읽기가 더 많을 때<br>• 즉시 반영 필요 시 | • 쓰기 많은 데이터<br>• 캐시 효율성 중요 시<br>• 실시간성 필요 시 | • 대량 데이터 처리<br>• 일시적 불일치 허용<br>• 배치 처리 가능 시 |

## 이커머스 서비스에 캐싱 전략 적용하기
### 읽기 작업만 빈번하게 일어나는 데이터

#### 상품(product) 조회
* 접근 패턴: 읽기 위주
* 데이터 변경 빈도: 낮음 (가격 변경)
* 일관성 요구사항: 높음
##### 상품 조회 캐싱 전략: Cache-Aside + Write-Through
- **읽기 전략 (Cache-Aside)**
    - 캐시 히트 시 즉시 반환
    - 캐시 미스 시 DB 조회 후 캐시 갱신
- **쓰기 전략 (Write-Through)**
    - 캐시와 DB 동시 갱신
    - 데이터 일관성 보장
    - TTL 설정으로 캐시 자동 갱신

#### 인기 상품(popular product) 조회
* 접근 패턴: 읽기 위주
* 데이터 변경 빈도: 낮음 (일 1회 집계; 총 판매 수량·집계 일자 필드가 변경될 일이 거의 없음)
* 일관성 요구사항: 낮음
	* 일 1회 집계되는 통계성 데이터로, 실시간성이 크게 중요하지 않음
	- 사용자 구매 결정에 참고 정보로만 활용됨
##### 인기 상품 조회 캐싱 전략: Cache-Aside + Write-Around
- **읽기 전략 (Cache-Aside)**
	* 인기 상품은 사전 캐싱
    - 전체 데이터를 단일 키로 캐싱 (3일간 가장 많이 팔린 상위 5개 상품 정보를 저장하므로)
    - 캐시 미스 시 전체 데이터 갱신
    - 장기 TTL 설정 (24시간)
- **쓰기 전략 (Write-Around)**
    - 배치 작업으로 DB 직접 갱신
    - 캐시 무효화 후 다음 조회 시 갱신
    - 실시간성보다 시스템 부하 감소 우선

### 읽기 작업과 쓰기 작업이 동시에 빈번하게 일어나는 데이터

#### 상품 재고(product stock) 조회
- **접근 패턴**: 읽기/쓰기 혼합
- **데이터 변경 빈도**: 매우 높음 (주문/환불/재입고)
- **일관성 요구사항**: 매우 높음 (초과 판매 방지 필수)
##### 상품 재고 조회 캐싱 전략: Cache-Aside + Write-Through
- **읽기 전략 (Cache-Aside)**
    - 캐시 확인 후 없으면 DB 조회
    - 애플리케이션이 직접 캐시 갱신 제어
    - 캐시 미스 시에만 DB 접근
    - 짧은 TTL 설정 (5분)
- **쓰기 전략 (Write-Through)**
    - Redis Transaction으로 원자성 보장
    - DB와 캐시 동시 갱신

## 결론: 이커머스 캐싱 전략 구현 방향

### 데이터 유형별 전략 요약

#### 상품(Product) 정보
- Cache-Aside + Write-Through 전략 채택
- 1시간 TTL 설정으로 캐시-DB 불일치 최소화
- 가격 변경 시 즉시 캐시 갱신으로 중요 정보 정확성 보장
- 상품 상세 정보는 상품ID를 키로 하여 개별 캐싱

#### 인기 상품(Popular Product) 목록
- Cache-Aside + Write-Around 전략 채택
- 3일간의 판매량 기준 상위 5개 상품을 단일 키로 캐싱
- 24시간 TTL과 일 1회 배치 갱신으로 시스템 부하 최소화
- 실시간 정확성보다 조회 성능 우선

#### 상품 재고(Product Stock) 정보
- Cache-Aside + Write-Through 전략 채택
- 5분 TTL로 최신성과 성능 균형 (write-through 쓰기 전략을 사용해 데이터 일관성은 여전히 보장됨)